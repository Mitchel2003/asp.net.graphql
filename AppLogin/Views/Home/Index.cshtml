@using System.Security.Claims
@{
    ViewData["Title"] = "Dashboard Principal";
}

<!-- Hero Section con bienvenida espectacular -->
<div class="row mb-5">
    <div class="col-12">
        <div class="position-relative overflow-hidden rounded-4 shadow-lg">
            <!-- Fondo gradiente animado -->
            <div class="gradient-bg p-5 text-white position-relative">
                <!-- Elementos decorativos flotantes -->
                <div class="position-absolute floating-element" style="top: 20%; right: 10%; width: 60px; height: 60px; background: rgba(255,255,255,0.1); border-radius: 50%; animation-delay: 0s;"></div>
                <div class="position-absolute floating-element" style="bottom: 30%; left: 15%; width: 40px; height: 40px; background: rgba(255,255,255,0.1); border-radius: 30%; animation-delay: 2s;"></div>
                <div class="position-absolute floating-element" style="top: 60%; right: 30%; width: 50px; height: 50px; background: rgba(255,255,255,0.1); border-radius: 40%; animation-delay: 1s;"></div>

                <div class="row align-items-center position-relative">
                    <div class="col-lg-8">
                        @if (User.Identity!.IsAuthenticated)
                        {
                            <div class="mb-3">
                                <span class="badge bg-success bg-gradient px-3 py-2 rounded-pill">
                                    <i class="bi bi-check-circle-fill me-2"></i>
                                    Sesión Activa
                                </span>
                            </div>
                            <h1 class="display-4 fw-bold mb-3 text-shadow">
                                ¡Bienvenido de vuelta,
                                <span class="text-warning">
                                    @User.Claims.Where(c => c.Type == ClaimTypes.Name).Select(c => c.Value).SingleOrDefault()!
                                </span>!
                            </h1>
                            <p class="lead mb-4 opacity-90">
                                Gestiona tu inventario de manera profesional y eficiente.
                                Agrega productos, controla stock y mantén tu negocio organizado.
                            </p>
                        }
                        else
                        {
                            <h1 class="display-4 fw-bold mb-3">
                                Sistema de Inventario Profesional
                            </h1>
                            <p class="lead mb-4 opacity-90">
                                La solución completa para gestionar tu inventario de manera eficiente.
                            </p>
                        }

                        <div class="d-flex flex-wrap gap-3">
                            <button class="btn btn-light btn-lg px-4 py-3 rounded-pill hover-lift pulse-glow">
                                <i class="bi bi-graph-up-arrow me-2"></i>
                                Ver Estadísticas
                            </button>
                            <button class="btn btn-outline-light btn-lg px-4 py-3 rounded-pill hover-lift">
                                <i class="bi bi-download me-2"></i>
                                Exportar Datos
                            </button>
                        </div>
                    </div>
                    <div class="col-lg-4 text-center">
                        <div class="position-relative">
                            <i class="bi bi-boxes display-1 opacity-25 floating-element"></i>
                            <div class="position-absolute top-50 start-50 translate-middle">
                                <div class="bg-white bg-opacity-10 rounded-circle p-4 pulse-glow">
                                    <i class="bi bi-plus-circle-fill fs-1"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Estadísticas rápidas -->
<div class="row mb-5">
    <div class="col-md-3 mb-4">
        <div class="card border-0 shadow-sm hover-lift h-100">
            <div class="card-body text-center">
                <div class="bg-primary bg-gradient rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                    <i class="bi bi-box-seam text-white fs-4"></i>
                </div>
                <h3 class="fw-bold text-primary mb-1">1,247</h3>
                <p class="text-muted mb-0">Productos Totales</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="card border-0 shadow-sm hover-lift h-100">
            <div class="card-body text-center">
                <div class="bg-success bg-gradient rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                    <i class="bi bi-check-circle text-white fs-4"></i>
                </div>
                <h3 class="fw-bold text-success mb-1">892</h3>
                <p class="text-muted mb-0">En Stock</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="card border-0 shadow-sm hover-lift h-100">
            <div class="card-body text-center">
                <div class="bg-warning bg-gradient rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                    <i class="bi bi-exclamation-triangle text-white fs-4"></i>
                </div>
                <h3 class="fw-bold text-warning mb-1">23</h3>
                <p class="text-muted mb-0">Stock Bajo</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="card border-0 shadow-sm hover-lift h-100">
            <div class="card-body text-center">
                <div class="bg-info bg-gradient rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                    <i class="bi bi-currency-dollar text-white fs-4"></i>
                </div>
                <h3 class="fw-bold text-info mb-1">$45,230</h3>
                <p class="text-muted mb-0">Valor Total</p>
            </div>
        </div>
    </div>
</div>

<!-- Formulario de Producto Espectacular -->
<div class="row">
    <div class="col-12">
        <div class="card border-0 shadow-lg rounded-4 overflow-hidden position-relative">
            <!-- Header del formulario con gradiente -->
            <div class="card-header border-0 position-relative overflow-hidden py-4">
                <div class="gradient-bg position-absolute w-100 h-100 opacity-90"></div>
                <div class="position-relative text-white">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h2 class="fw-bold mb-2">
                                <i class="bi bi-plus-circle-fill me-3 fs-1"></i>
                                Agregar Nuevo Producto
                            </h2>
                            <p class="mb-0 opacity-90">
                                Completa la información del producto para agregarlo a tu inventario
                            </p>
                        </div>
                        <div class="col-md-4 text-md-end">
                            <div class="floating-element">
                                <i class="bi bi-box-seam display-4 opacity-50"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cuerpo del formulario -->
            <div class="card-body p-5">
                <form method="post" class="needs-validation" novalidate>
                    <div class="row">
                        <!-- Información básica -->
                        <div class="col-lg-6">
                            <h5 class="fw-bold text-primary mb-4">
                                <i class="bi bi-info-circle-fill me-2"></i>
                                Información Básica
                            </h5>

                            <!-- Nombre del producto -->
                            <div class="mb-4">
                                <label for="productName" class="form-label fw-semibold">
                                    <i class="bi bi-tag-fill me-2 text-primary"></i>
                                    Nombre del Producto
                                </label>
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text bg-light border-end-0">
                                        <i class="bi bi-box text-muted"></i>
                                    </span>
                                    <input type="text"
                                            class="form-control border-start-0 ps-0"
                                            id="productName"
                                            name="productName"
                                            placeholder="Ej: iPhone 15 Pro Max"
                                            required>
                                    <div class="invalid-feedback">
                                        El nombre del producto es requerido.
                                    </div>
                                </div>
                            </div>

                            <!-- Descripción -->
                            <div class="mb-4">
                                <label for="description" class="form-label fw-semibold">
                                    <i class="bi bi-card-text me-2 text-primary"></i>
                                    Descripción
                                </label>
                                <textarea class="form-control form-control-lg"
                                            id="description"
                                            name="description"
                                            rows="4"
                                            placeholder="Describe las características principales del producto..."
                                            required></textarea>
                                <div class="invalid-feedback">
                                    La descripción es requerida.
                                </div>
                            </div>

                            <!-- Categoría -->
                            <div class="mb-4">
                                <label for="category" class="form-label fw-semibold">
                                    <i class="bi bi-grid-3x3-gap-fill me-2 text-primary"></i>
                                    Categoría
                                </label>
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text bg-light border-end-0">
                                        <i class="bi bi-collection text-muted"></i>
                                    </span>
                                    <select class="form-select border-start-0 ps-0" id="category" name="category" required>
                                        <option value="">Selecciona una categoría</option>
                                        <option value="electronics">📱 Electrónicos</option>
                                        <option value="clothing">👕 Ropa y Accesorios</option>
                                        <option value="home">🏠 Hogar y Jardín</option>
                                        <option value="sports">⚽ Deportes</option>
                                        <option value="books">📚 Libros</option>
                                        <option value="automotive">🚗 Automotriz</option>
                                        <option value="health">💊 Salud y Belleza</option>
                                        <option value="toys">🧸 Juguetes</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Selecciona una categoría.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Información comercial -->
                        <div class="col-lg-6">
                            <h5 class="fw-bold text-success mb-4">
                                <i class="bi bi-currency-dollar me-2"></i>
                                Información Comercial
                            </h5>

                            <!-- Precio -->
                            <div class="mb-4">
                                <label for="price" class="form-label fw-semibold">
                                    <i class="bi bi-cash-coin me-2 text-success"></i>
                                    Precio Unitario
                                </label>
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text bg-light border-end-0">
                                        <i class="bi bi-currency-dollar text-muted"></i>
                                    </span>
                                    <input type="number"
                                            class="form-control border-start-0 ps-0"
                                            id="price"
                                            name="price"
                                            placeholder="0.00"
                                            step="0.01"
                                            min="0"
                                            required>
                                    <div class="invalid-feedback">
                                        El precio es requerido y debe ser mayor a 0.
                                    </div>
                                </div>
                            </div>

                            <!-- Cantidad en stock -->
                            <div class="mb-4">
                                <label for="stock" class="form-label fw-semibold">
                                    <i class="bi bi-boxes me-2 text-success"></i>
                                    Cantidad en Stock
                                </label>
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text bg-light border-end-0">
                                        <i class="bi bi-hash text-muted"></i>
                                    </span>
                                    <input type="number"
                                            class="form-control border-start-0 ps-0"
                                            id="stock"
                                            name="stock"
                                            placeholder="0"
                                            min="0"
                                            required>
                                    <div class="invalid-feedback">
                                        La cantidad en stock es requerida.
                                    </div>
                                </div>
                            </div>

                            <!-- SKU -->
                            <div class="mb-4">
                                <label for="sku" class="form-label fw-semibold">
                                    <i class="bi bi-upc-scan me-2 text-success"></i>
                                    Código SKU
                                </label>
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text bg-light border-end-0">
                                        <i class="bi bi-qr-code text-muted"></i>
                                    </span>
                                    <input type="text"
                                            class="form-control border-start-0 border-end-0 ps-0"
                                            id="sku"
                                            name="sku"
                                            placeholder="SKU-001"
                                            required>
                                    <button class="btn btn-outline-secondary border-start-0"
                                            type="button"
                                            onclick="generateSKU()">
                                        <i class="bi bi-arrow-clockwise"></i>
                                    </button>
                                    <div class="invalid-feedback">
                                        El código SKU es requerido.
                                    </div>
                                </div>
                            </div>

                            <!-- Estado del producto -->
                            <div class="mb-4">
                                <label class="form-label fw-semibold">
                                    <i class="bi bi-toggle-on me-2 text-success"></i>
                                    Estado del Producto
                                </label>
                                <div class="d-flex gap-4 mt-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="status" id="active" value="active" checked>
                                        <label class="form-check-label fw-semibold text-success" for="active">
                                            <i class="bi bi-check-circle-fill me-2"></i>
                                            Activo
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="status" id="inactive" value="inactive">
                                        <label class="form-check-label fw-semibold text-warning" for="inactive">
                                            <i class="bi bi-pause-circle-fill me-2"></i>
                                            Inactivo
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de imagen -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <h5 class="fw-bold text-info mb-4">
                                <i class="bi bi-image-fill me-2"></i>
                                Imagen del Producto
                            </h5>
                            <div class="border-2 border-dashed border-info rounded-4 p-5 text-center hover-lift">
                                <i class="bi bi-cloud-upload display-4 text-info mb-3"></i>
                                <h6 class="fw-bold text-info mb-2">Arrastra y suelta tu imagen aquí</h6>
                                <p class="text-muted mb-3">O haz clic para seleccionar un archivo</p>
                                <input type="file" class="form-control d-none" id="productImage" name="productImage" accept="image/*">
                                <button type="button" class="btn btn-outline-info btn-lg px-4" onclick="document.getElementById('productImage').click()">
                                    <i class="bi bi-folder2-open me-2"></i>
                                    Seleccionar Imagen
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Botones de acción -->
                    <div class="row mt-5">
                        <div class="col-12">
                            <div class="d-flex flex-wrap gap-3 justify-content-center">
                                <button type="submit"
                                        class="btn btn-primary btn-lg px-5 py-3 rounded-pill hover-lift pulse-glow">
                                    <i class="bi bi-plus-circle-fill me-2"></i>
                                    Agregar Producto
                                </button>
                                <button type="button"
                                        class="btn btn-outline-secondary btn-lg px-5 py-3 rounded-pill hover-lift"
                                        onclick="clearForm()">
                                    <i class="bi bi-arrow-clockwise me-2"></i>
                                    Limpiar Formulario
                                </button>
                                <button type="button"
                                        class="btn btn-outline-info btn-lg px-5 py-3 rounded-pill hover-lift">
                                    <i class="bi bi-eye-fill me-2"></i>
                                    Vista Previa
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Scripts específicos de la página -->
<script>
    // Validación de formulario
    (function() {'use strict';
        window.addEventListener('load', function() {
            var forms = document.getElementsByClassName('needs-validation');
            var validation = Array.prototype.filter.call(forms, function(form) {
                form.addEventListener('submit', function(event) {
                    if (form.checkValidity() === false) { event.preventDefault(); event.stopPropagation(); }
                    form.classList.add('was-validated');
                }, false);
            });
        }, false);
    })();

    // Generar SKU automático
    function generateSKU() {
        const prefix = 'SKU';
        const timestamp = Date.now().toString().slice(-6);
        const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
        const sku = `${prefix}-${timestamp}-${random}`;
        document.getElementById('sku').value = sku;
    }

    // Limpiar formulario
    function clearForm() {
        document.querySelector('form').reset();
        document.querySelector('form').classList.remove('was-validated');
    }

    // Efectos visuales adicionales
    document.addEventListener('DOMContentLoaded', function() {
        // Efecto de focus en inputs
        const inputs = document.querySelectorAll('.form-control, .form-select');
        inputs.forEach(input => {
            input.addEventListener('focus', function() { this.parentElement.classList.add('shadow-sm'); this.style.transform = 'scale(1.02)'; });
            input.addEventListener('blur', function() { this.parentElement.classList.remove('shadow-sm'); this.style.transform = 'scale(1)'; });
        });

        // Contador de caracteres para descripción
        const description = document.getElementById('description');
        description.addEventListener('input', function() {
            const maxLength = 500;
            const currentLength = this.value.length;
            const remaining = maxLength - currentLength;

            if (!document.getElementById('charCounter')) {
                const counter = document.createElement('small');
                counter.id = 'charCounter';
                counter.className = 'text-muted';
                this.parentElement.appendChild(counter);
            }

            document.getElementById('charCounter').textContent = `${currentLength}/${maxLength} caracteres`;
            if (remaining < 50) { document.getElementById('charCounter').className = 'text-warning'; }
            else { document.getElementById('charCounter').className = 'text-muted'; }
        });

        // Preview de imagen
        document.getElementById('productImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.createElement('img');
                    preview.src = e.target.result;
                    preview.className = 'img-thumbnail mt-3';
                    preview.style.maxWidth = '200px';

                    const existingPreview = document.querySelector('.img-thumbnail');
                    if (existingPreview) { existingPreview.remove(); }
                    document.getElementById('productImage').parentElement.appendChild(preview);
                };
                reader.readAsDataURL(file);
            }
        });
    });
</script>